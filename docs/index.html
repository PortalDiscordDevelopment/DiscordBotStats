<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Charts</title>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="module">
            fetch('https://raw.githubusercontent.com/PortalDiscordDevelopment/MultiBotRunner/main/data/data.json')
                .then((res) => res.json())
                .then((data) => {
                    const servers = [['Date']],
                        users = [['Date']],
                        shards = [['Date']];

                    Object.entries(data).map(([timestamp, v]) => {
                        Object.keys(v).map((bot) => {
                            if (!servers.at(0).includes(bot)) servers.at(0).push(bot);
                            if (!users.at(0).includes(bot)) users.at(0).push(bot);
                            if (!shards.at(0).includes(bot)) shards.at(0).push(bot);
                        });

                        servers.push([new Date(Number(timestamp)), ...Object.values(v).map((i) => i.guildCount)]);
                        users.push([new Date(Number(timestamp)), ...Object.values(v).map((i) => i.userCount)]);
                        shards.push([new Date(Number(timestamp)), ...Object.values(v).map((i) => i.shardCount)]);
                    });

                    google.charts.load('current', { packages: ['corechart'] });
                    google.charts.setOnLoadCallback(() => {
                        drawChart('Total Servers', servers);
                        drawChart('Total Users', users);
                        drawChart('Total Shards', shards);
                    });

                    function drawChart(title, table) {
                        const data = google.visualization.arrayToDataTable(table);

                        const options = {
                            title,
                            curveType: 'function',
                            legend: { position: 'bottom' },
                        };

                        const chart = new google.visualization.LineChart(document.getElementById(title.replace(/ +/gim, '')));

                        chart.draw(data, options);
                    }
                });
        </script>

        <style>
            body {
                background: darkslateblue;
                text-align: center;
            }

            .chart {
                background-color: white;
                color: grey;
                border: 2px solid black;
                border-radius: 0.5rem;
                height: 50vh;
                margin: 10px;
                padding: 5px;
            }
        </style>
    </head>
    <body>
        <div class="chart" id="TotalServers"></div>
        <div class="chart" id="TotalUsers"></div>
        <div class="chart" id="TotalShards"></div>
    </body>
</html>
